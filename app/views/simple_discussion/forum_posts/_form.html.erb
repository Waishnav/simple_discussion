<div class="mt-4"></div>
<%= form_for [@forum_thread, @forum_post],
  url: (@forum_post.persisted? ? simple_discussion.forum_thread_forum_post_path(@forum_thread, @forum_post) : simple_discussion.forum_thread_forum_posts_path(@forum_thread)),
  html: {
    data: {
      controller: "simplemde",
      simplemde_circuit_embed_value: SimpleDiscussion.markdown_circuit_embed,
      simplemde_user_tagging_value: SimpleDiscussion.markdown_user_tagging,
      simplemde_video_embed_value: SimpleDiscussion.markdown_video_embed,
    }
  } do |f| %>

  <% if @forum_post.errors.any? %>
    <div class="alert alert-danger" role="alert">
      <% @forum_post.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </div>
  <% end %>

  <div class="d-block position-relative">
    <div class="form-group">
      <%= f.text_area :body, placeholder: t('add_a_comment'), rows: 8, class: "form-control", data: { simplemde_target: "textarea" } %>
    </div>
    <%= f.button "#{f.object.new_record? ? t('comment') : t('update_comment')}", class: "btn forum-primary-btn", style: "bottom: 10px; right: 10px", data: { disable_with: "<i class='fa fa-spinner fa-spin'></i> #{t('saving_comment')}" } %>
  </div>

  <!-- Users for tagging -->
  <div class="dropdown-menu" data-simplemde-target="tagDropdown">
    <% users = User.joins(forum_posts: :forum_thread)
                   .where(forum_threads: { id: @forum_thread.id })
                   .distinct %>
    <% users.each do |user| %>
      <button class="dropdown-item" type="button" data-name="<%= user.name %>" data-profile-link="<%= user_profile_link(user) %>">
        <%# image_tag user.profile_picture, class: "rounded-circle", style: "width: 20px; height: 20px" %>
        <img class="rounded-circle mr-1" src="<%= gravatar_url_for(@forum_post.user.email, size: 24) %>" alt="avatar of user">
        <%= user.name %>
      </button>
    <% end %>
  </div>
<% end %>

<!-- Embed Circuit Modal -->
<div class="modal fade" id="embedCircuitModal" tabindex="-1" aria-labelledby="embedCircuitModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="embedCircuitModalLabel">Embed Circuit</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="circuitEmbedLink" class="form-label">Circuit Embed Link:</label>
            <input class="form-control" id="circuitEmbedLink" placeholder="Enter the circuit embed link">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn forum-primary-btn" id="insertCircuitEmbed">Insert</button>
      </div>
    </div>
  </div>
</div>

<!-- Embed Video Modal -->
<div class="modal fade" id="embedVideoModal" tabindex="-1" aria-labelledby="embedVideoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="embedVideoModalLabel">Embed YouTube Video</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="videoEmbedLink" class="form-label">YouTube Video Link:</label>
            <input type="url" pattern="https://*" class="form-control" id="videoEmbedLink" placeholder="Enter the YouTube video link">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn forum-primary-btn" id="insertVideoEmbed">Insert</button>
      </div>
    </div>
  </div>
</div>
